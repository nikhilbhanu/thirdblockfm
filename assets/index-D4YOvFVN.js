import{e as k}from"./esm-CjBiRZQc.js";import{g as S}from"./index-NpGfcWmN.js";var j,_;function I(){return _||(_=1,j=Worker),j}var W=I();const D=S(W),z=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),w=new WeakMap,M=String.raw`dynEncode01658cce3922eÆØÒfeeefsfÅoääääääääääegtfhÊÓÛkÒÊÒÔ×Þgeghgfekmfäe¦åíiplgnÈÔ××ÊÑÆÙÊeepÄÄÍÊÆÕÄÇÆØÊheofivälànâiá©eeeeeeeeg¥g¥g¦g­reg¦fÐ|f¦v³i¥f¦uÐz¦efÐ}ef¦gÙxÏ~e¦¥Ðuth¥ffwÑvÏ{tpuo¦eqh¥eqg¦gÙÏqqbeeeegvÏ¦gÙÏbeeebIfbpeeeg¦i×q¦gÙÏrrbeeeeqvÏ¦gÙÏbeeebIfbpeeeg¦m×q¦gÙÏrrbeeeeqvÏ¦gÙÏbeeebIfbpeeeg¦q×q¦gÙÏrrbeeeeqvÏ¦gÙÏbeeebIfbpeepr¦¥Ðpos¦¥Ðog¦uÏqz­repg¥fq±reg¥fqÐo¦i®reeqvÏ¦gÙÏ~®iäeq¦gÙÏe{¦gÙÏ®j¦epreo¦áÖ{¦iÐp¦gÛ¦fÏ¦fÖg¥pªi¥¦egqfpzgÐ¦áÖ¦iÐ¦gÛ¦fÏ¦cdddlÖp¦egh¥srbegesbegebIfbpgesrbegusbegubIfbpgur¦Ïrs¦Ïsg¦mÏgp¦gÐpreppi¥egqÏg¦gÙÏpegvÏ¦gÙÏbegepbegebIfbpgepo{«rffq{ÏqÐopq¦äØgo¦fÖiäeq¦gÙÏoeqvÏ¦gÙÏgeoge÷geq¦fÏjqpqg}«refqÐpyq¦gÙoÏregh¥goÏqgrÏsgeqge÷geqsgiqgi÷gig¦mÏgp¦gÐpreppxyÏytxÏtw¦fÏw|¬repqfpf¦e±re¦efÐtf¦fÖuef¦gÙvÏwf¦i®yf¦áÖo¦q«zh¥frÑs¦egg¥g¥yreeefsÏ¦gÙÏ®wes¦gÙÏq°ÖreeqbegeebegebIfbpgeg¥o¦i«reeqbeguebegubIfbpguo¦m«reeqbegebegbIfbpgzreeqbegebegbIfbpgpfog«rfpg¦äØquiäeg¦gÙÏxegsÏ¦gÙÏgexge÷geg¦f×jgpgqt«refgÐqpg¦gÙxÏ{egh¥gxÏsg{Ï}gesge÷ges}gisgi÷gig¦mÏgq¦gÐqrepppvÏpr¦fÏr|¬reppg¥j¦g­rej¦fÐvi¦v³i¥i¦uÐ|¦ey¦eiÐ{hi¦gÙzÏ}h¦¥Ðjt¦ewh¥iiwÑuÏxtpjo¦eqh¥hqg¦gÙÏqqbeeehguÏ¦gÙÏbeeebIfbpeehg¦i×q¦gÙÏrrbeeehquÏ¦gÙÏbeeebIfbpeehg¦m×q¦gÙÏrrbeeehquÏ¦gÙÏbeeebIfbpeehg¦q×q¦gÙÏrrbeeehquÏ¦gÙÏbeeebIfbpeepr¦¥Ðpos¦¥Ðog¦uÏq|­repg¥iq±reg¥iqÐo¦i®rehquÏ¦gÙÏ}®iähq¦gÙÏhx¦gÙÏ®j¦epreo¦áÖx¦iÐp¦gÛ¦fÏ¦fÖ~g¥pªi¥¦egqfp|gÐ¦áÖ¦iÐ¦gÛ¦fÏ¦cdddlÖp¦egh¥srbegesbegebIfbpgesrbegusbegubIfbpgur¦Ïrs¦Ïsg¦mÏgp¦gÐprepp~i¥hgqÏg¦gÙÏphguÏ¦gÙÏbegepbegebIfbpgepox«rfiqxÏqÐopq¦äØgo¦fÖiähq¦gÙÏohquÏ¦gÙÏgeoge÷geq¦fÏjqpqg{«reiqÐpyq¦gÙoÏrhgh¥goÏqgrÏsgeqge÷geqsgiqgi÷gig¦mÏgp¦gÐpreppyzÏytzÏtw¦fÏwv¬repqfpi¦e±re¦ep¦eiÐsi¦fÖthi¦gÙuÏwi¦i®yi¦áÖj¦q«|¦erh¥irÑo¦egg¥g¥yrehhioÏ¦gÙÏ®who¦gÙÏq°ÖrehqbegehbegebIfbpgeg¥j¦i«rehqbeguhbegubIfbpguj¦m«rehqbeghbegbIfbpg|rehqbeghbegbIfbpgpjgi«rfpg¦äØqtiähg¦gÙÏzhgoÏ¦gÙÏgezge÷geg¦f×jgpgqs«reigÐqpg¦gÙzÏxhgh¥gzÏogxÏ{geoge÷geo{giogi÷gig¦mÏgq¦gÐqrepppuÏpr¦fÏrv¬repp¦ein¦egem¦egeg¥k¦e¯i¥k¦hÖjg¥k¦fÐi¦h®i¥¦eoqfpegk¦áÖoqh¥gge ggi ggm ggq g¦uÏgq¦iÐqreppji¥eo¦gÙÏgjqh¥gge g¦iÏgq¦fÐqreppg¥i¦h®i¥¦eoqfphgk¦áÖoqh¥gge ggi ggm ggq g¦uÏgq¦iÐqreppji¥ho¦gÙÏgh¥gge g¦iÏgj¦fÐjreppk¦uÐskk¦v­i¥¦ei¦eqqgpbx¦ejhgh¥gbeeebJfbKfbIfgbeeubJfbKfbIfgbeebJfbKfbIfgbeebJfbKfbIfg¦¥Ðgj¦uÏjs­repi¦ÕÖq¦fiqfpk¦uÐsk¦eqpbhbgbebf÷÷÷g¥kq±req¦äØkÏpk¦hÖoiähq¦gÙÏgojh¥ggeøù÷g¦iÏgj¦fÐjrepoq×jqpqp¦h®rekqÐjhq¦gÙÏgh¥ggqøùggmøùggiøùggeøù÷÷÷÷g¦uÏgj¦iÐjrepp¦ejii¥bxhgh¥ggbeeebJfbpeeggbeeubJfbpeuggbeebJfbpeggbeebJfbpeg¦¥Ðgj¦uÏjs­reppk¨eeå$÷úfkÐtg¥jk³rekkjÐf¦h°iäf¦áÖr¦iÐg¦gÛ¦fÏo¦hÖqbx¦epg¦q´i¥o¦adddlÖohj¦gÙÏgh¥ggbegebJfbpgeggbegubJfbpguggbegbJfbpgggbegbJfbpgg¦¥Ðgp¦uÏpo¦iÐoreppqi¥hjpÏ¦gÙÏgh¥ggbegebJfbpgeg¦uÏgq¦fÐqreppfr«rfjrÏjjpjÐqhj¦gÙÏgh¥gggeøgeg¦iÏgq¦fÐqreppöt¦e¯i¥l¦gÙu¦er¦ekÐvk¦fÖwk¦fÐ¦ÕÖq eoh¥er¦gÙÏygeekrÏ¦gÙÏ|gäiªi¥bqeeeeeeeeeeeeeeeebqeeeeeeeeeeeeeeee¦eqfpbx¦eg¦epbqeeeeeeeeeeeeeeeebqeeeeeeeeeeeeeeeeh¥goÏfbeeebJfghÏjbeeebKfbIffbeeubJfjbeeubKfbIffbeebJfjbeebKfbIffbeebJfjbeebKfbIfbKfbIfbKfbIfbKfbIfbKfbIfg¦¥Ðgp¦uÏps­repqpf|gebhbgbebf÷÷÷bhbgbebf÷÷÷g¥fk³ref¦äØgwiäyf¦gÙjÏgeøhjÏgeù÷ù÷f¦f×jfpfgv«ref¦gÙgkfÐjh¥goÏfgiøghÏpgiùfgeøpgeù÷÷ùù÷÷g¦mÏgj¦gÐjreppú ú mgeÃi¥nrgemgep  ouÏolrÏrt­reppg¥l¦f±rengefllÑgÏjtjt­t¦epfgÐf¦ef¦e¯rg¥k¦e±i¥qfpk¦hÖjg¥k¦fÐ¦h®i¥qfper¦gÙÏgk¦áÖpqh¥gge ggi ggm ggq g¦uÏgq¦iÐqreppjªreeprÏ¦gÙÏgh¥gge g¦iÏgj¦fÐjrepprt³re¦ekÐpk¦fÖuer¦gÙÏok¦fÐ¦ÕÖl h¥er¦gÙÏvgeekrÏ¦gÙÏwgäiªi¥bqeeeeeeeeeeeeeeeebqeeeeeeeeeeeeeeee¦eqfpbx¦eqoghjbqeeeeeeeeeeeeeeeebqeeeeeeeeeeeeeeeeh¥gbeeebJfjbeeebKfbIfgbeeubJfjbeeubKfbIfgbeebJfjbeebKfbIfgbeebJfjbeebKfbIfbKfbIfbKfbIfbKfbIfbKfbIfg¦¥Ðgj¦¥Ðjq¦uÏqs­replpfwgebhbgbebf÷÷÷bhbgbebf÷÷÷g¥fk³ref¦äØguiävf¦gÙjÏgeøhjÏgeù÷ù÷f¦f×jfpfgp«ref¦gÙgkfÐjh¥goÏfgiøghÏqgiùfgeøqgeù÷÷ùù÷÷g¦mÏgj¦gÐjreppú ú mgeÃi¥nrgemgep  o¦iÏor¦fÏrt¬reppppetÙÆ×ÌÊÙÄËÊÆÙÚ×ÊØflØÎÒÉ`,C=String.raw`dynEncode010e15d7b662o{+nnns|{s{}O)q}szosmmvso~mpos  ÚN.OV.Oy/.O\N.Oy/.O/.O/N./O/N...x08.8 F..8.8 F..8.8 F..8.8 F.Ox/.Ox/.Ox/..VN..Oy0Z....x8.8 F../..T..y/..O0x/./N..x0..x08.8 F..8.8 F.Ox/.Oy0..x/..Ox0U.OZ.O/.8/.OT/.OT/./N..8. 0FN...8.8 F.OT..8.8 F...8.8 F..x/.Oy0N.0OVO.Oy/N..x08.¡0..x08¢.8.¡0.8¢.8.¡0.8¢.8.¡0.8¢.    /..¢..¢..¢..¢.    /.Ox/.Ox0.V.OyO0.\.O/.O..O0x8.¡0..x8¢. /..¢. /.O./O.y.T..y/..O0x/..x/N.8.¡0.¢.8.¡0.¢.  /..8¢..8¢.  /.Ox/.Ox/.Oy0..ÀQÍ 0£É..£É­.É°±ÄÊR/$N.......OD.ODN.OXN.O/.Oy0O]N./.O0/N. .8É®.8É®.8É®.8É®/ .Ox/.Oy0.N.O.x/./N. .8É®/ .Ox/.Oy0N.OWNO/./.O0/N.!.8É®.8É®.8É®.8É®/!.Ox/.Oy0.N.O.x/N.!.8É®/!.Ox/.Oy0.Oy/.À/.OVNO/O/.!Ä.£/O/./N.8.¡0.¢.8.¡0.¢.8.¡0.¢.8.¡0.¢.    /.Ox/.Ox0.V.O/O/.Oy/.À/O/.!.Å0!±Ä/N..\..Ox/.O0.O.x/./N.8.¡0.¢. /.Ox/.Oy0.../.OW..y/.O.x/N.8.¡0.¢.8.¡0.¢.8.¡0.¢.8.¡0.¢.    /.Ox/.Oy0O/.N./N..8.¡F..8.¡F..8.¡F..8.¡F.Ox/.Ox0.V..QÍ £/..y/N..\..Ox/..yO0N.O.x/N..8.¡F.Ox/.Ox/.Oy0.OW..y/.O.x/N..8.¡F..8.¡F..8.¡F..8.¡F.Ox/.Oy0./N.OZNO/.O/.O/O/./O/N. .8É¯/"..x8É/#.8/... .!±Ä..0.l..D..F../.".#®/ ..x/..x0.VN.OZ...z0x0...V)/O/..y0O.OX)/N.OZN.$/ .O/N.OyOWN.$/ .O.x/.$/ .O0/N. .8É®.8É®.8É®.8É®/ .Ox/.Oy0.S..xO.x/N. .8É®/ .Ox/.Oy0..\.O.x/..xO.x/N. .8É¯/".8É/#.8/... .!±Ä..0.lN..D..F.".#®/ .Ox/.Ox/.Ox0.U`;class v{constructor(a={}){this._correlationSampleSize=a.correlationSampleSize>0?a.correlationSampleSize:11025,this._initialGranularity=a.initialGranularity>0?a.initialGranularity:16,this._correlationThreshold=a.correlationThreshold>=0?a.correlationThreshold:.5,this._module=w.get(v),this._module||(this._module=z().then(l=>l?WebAssembly.compile(k(M)):WebAssembly.compile(k(C))),w.set(this._module)),this.SynAudioWorker=function l(d,m,y){this._sourceCache=new Map,this._getCorrelationSampleSize=(r,o)=>Math.min(r.samplesDecoded,o.samplesDecoded,this._correlationSampleSize),this._getInitialGranularity=(r,o)=>Math.min(r.samplesDecoded,o.samplesDecoded,this._initialGranularity),this._setAudioDataOnHeap=(r,o,f)=>{const p=o.BYTES_PER_ELEMENT;let h=f/p;for(let i=0;i<r.length;i++)f+=r[i].length*p,o.set(r[i],h),h+=r[i].length;return f},this._executeAsWorker=(r,o)=>{let f=this._sourceCache.get(r);if(!f){let i="text/javascript",c,q=`'use strict';(${((u,b,e,g)=>{self.onmessage=t=>{new u(Promise.resolve(t.data.module),e,g)._workerMethods.get(b).apply(null,t.data.params).then(s=>{self.postMessage(s)})}}).toString()})(${l.toString()}, "${r}", ${this._correlationSampleSize}, ${this._initialGranularity})`;try{c=typeof process.versions.node<"u"}catch{}f=c?`data:${i};base64,${Buffer.from(q).toString("base64")}`:URL.createObjectURL(new Blob([q],{type:i})),this._sourceCache.set(r,f)}const p=new(globalThis.Worker||D)(f,{name:"SynAudio"}),h=new Promise(i=>{p.onmessage=c=>{p.terminate(),i(c.data)}});return this._module.then(i=>{p.postMessage({module:i,params:o})}),h},this._sync=(r,o)=>{const p=Float32Array.BYTES_PER_ELEMENT,h=this._getCorrelationSampleSize(r,o),i=this._getInitialGranularity(r,o),c=new WebAssembly.Memory({initial:(r.samplesDecoded*r.channelData.length+o.samplesDecoded*o.channelData.length)*p/65536+4});return this._module.then(q=>WebAssembly.instantiate(q,{env:{memory:c}})).then(({exports:q})=>{const u=new Map(Object.entries(q)),b=u.get("correlate"),e=new Float32Array(c.buffer),g=new DataView(c.buffer),t=u.get("__heap_base").value,n=this._setAudioDataOnHeap(r.channelData,e,t),s=this._setAudioDataOnHeap(o.channelData,e,n),O=s+p;b(t,r.samplesDecoded,r.channelData.length,n,o.samplesDecoded,o.channelData.length,h,i,s,O);const x=g.getFloat32(s,!0),N=g.getInt32(O,!0);return{correlation:x,sampleOffset:N}})},this._syncWorkerConcurrent=(r,o,f)=>{const p=[],h=[0],i=this._getCorrelationSampleSize(r,o),c=Math.log(r.samplesDecoded*i)/Math.log(this._initialGranularity+1)*Math.log(i/1e4+1);f=Math.max(Math.round(Math.min(f,c,r.samplesDecoded/i/4)),1);const q=Math.ceil(r.samplesDecoded/f);let u=0;for(let b=0;b<f;b++){const e={channelData:[]};for(let g=0;g<r.channelData.length;g++){const t=r.channelData[g].subarray(u,u+q+i);e.channelData.push(t),e.samplesDecoded=t.length}u+=q-i,h.push(u),p.push(this._syncWorker(e,o))}return Promise.all(p).then(b=>{let e=0,g=-1;for(let t=0;t<b.length;t++)b[t].correlation>g&&(e=t,g=b[t].correlation);return{correlation:b[e].correlation,sampleOffset:b[e].sampleOffset+h[e]}})},this._syncWorker=(r,o)=>this._executeAsWorker("_sync",[r,o]),this._syncWorkerConcurrentMain=(r,o,f)=>globalThis.Worker?this._executeAsWorker("_syncWorkerConcurrent",[r,o,f]):this._syncWorkerConcurrent(r,o,f),this._workerMethods=new Map([["_sync",this._sync],["_syncWorker",this._syncWorker],["_syncWorkerConcurrent",this._syncWorkerConcurrent]]),this._module=d,this._correlationSampleSize=m,this._initialGranularity=y},this._instance=new this.SynAudioWorker(this._module,this._correlationSampleSize,this._initialGranularity)}async syncWorkerConcurrent(a,l,d){return this._instance._syncWorkerConcurrentMain(a,l,d>=1?d:1)}async syncWorker(a,l){return this._instance._syncWorker(a,l)}async sync(a,l){return this._instance._sync(a,l)}async syncMultiple(a,l){l=l>=1?l:8;const d=[],m=[];let y=()=>{},r=Promise.resolve(),o=0;const f=()=>{r=new Promise(e=>{y=e})};for(let e=0;e<a.length;e++)m.push({vertex:{}});for(let e=0;e<a.length;e++){const g=a[e],t=m[e].vertex;t.name=g.name,t.samplesDecoded=g.data.samplesDecoded,t.edges=new Set;for(let n=0;n<a.length;n++){if(e===n)continue;const s=a[n],O=m[n];o++,d.push(this.syncWorker(g.data,s.data).then(x=>{x.correlation>this._correlationThreshold&&t.edges.add({parent:t,vertex:O.vertex,samplesDecoded:s.data.samplesDecoded,...x}),o--,y()})),o>=l&&(f(),await r)}}await Promise.all(d);const p=(e,g)=>e.parent&&g.parent&&e.parent.samplesDecoded!==g.parent.samplesDecoded?e.parent.samplesDecoded>g.parent.samplesDecoded:e.correlation!==g.correlation?e.correlation>g.correlation:e.sampleOffset!==g.sampleOffset?e.sampleOffset>g.sampleOffset:e.vertex&&g.vertex&&e.vertex.name.localeCompare(g.vertex.name)<0,h=new Map,i=new Set,c=e=>{for(const g of e.edges.values()){if(h.has(e))return h.get(e);h.set(e,g);const t=c(g.vertex),n=g;if(t){let s,O;p(t,n)?(s=t,O=n):(s=n,O=t),O.cycleWith||(O.cycleWith=new Set,i.add(O)),O.cycleWith.add(s),s.cycleWith&&s.cycleWith.delete(O)}h.delete(e)}};for(const{vertex:e}of m)c(e);for(const e of i)e.cycleWith.size&&e.parent.edges.delete(e);const q=new Set;for(const e of m)q.add(e.vertex);for(const e of m)for(const g of e.vertex.edges)q.delete(g.vertex);const u=(e,g,t,n=0)=>{for(const s of t)e.has(s.vertex)&&p(e.get(s.vertex),s)||e.set(s.vertex,{name:s.vertex.name,correlation:s.correlation,sampleOffset:n+s.sampleOffset}),u(e,g,s.vertex.edges,n+s.sampleOffset)},b=[];for(const e of q){const g=new Map;g.set(e,{name:e.name,sampleOffset:0}),u(g,e,e.edges),b.push([...g.values()].sort((t,n)=>t.sampleOffset-n.sampleOffset||(t.correlation||0)-(n.correlation||0)||n.name.localeCompare(t.name)))}return b}}export{v as default};
